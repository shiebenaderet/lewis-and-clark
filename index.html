<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The Lost Expedition - Retracing Lewis &amp; Clark</title>
<link rel="stylesheet" href="css/styles.css">
<link rel="stylesheet" href="css/trail-game.css">
</head>
<body>

<!-- ============================================================
     TITLE SCREEN
     ============================================================ -->
<div id="title-screen" class="screen active">
  <div class="title-stars"></div>
  <div class="title-content">
    <div class="title-year">1804 &ndash; 1806</div>
    <h1 class="title-main">The Lost Expedition</h1>
    <p class="title-subtitle">Retracing the Journey of Lewis &amp; Clark</p>
    <div class="title-divider"></div>
    <p class="title-intro">
      A tattered journal has been found in an old St. Louis library. Its pages tell the story of the Corps of Discovery &mdash; but many entries are missing. Your mission: retrace the expedition's path across the continent, recover the lost journal entries at each station, and piece together the full story of America's greatest exploration.
    </p>
    <div class="level-select">
      <span class="level-select-label">Choose your reading level:</span>
      <div class="level-buttons">
        <button class="level-btn" data-level="beginner" onclick="setLevel('beginner')">Easier Vocabulary</button>
        <button class="level-btn active" data-level="standard" onclick="setLevel('standard')">Standard</button>
        <button class="level-btn" data-level="advanced" onclick="setLevel('advanced')">Advanced</button>
      </div>
    </div>
    <button class="btn-start" onclick="startGame()">Begin the Expedition</button>
    <div id="title-continue" class="title-continue"></div>
    <details class="save-code-panel">
      <summary class="teacher-toggle">Save &amp; Load Progress</summary>
      <div class="save-code-controls">
        <p style="margin:0 0 0.75rem;font-size:0.85rem;color:var(--parchment-dark);">Use save codes to transfer your progress between devices, or bookmark your place.</p>
        <div style="display:flex;gap:0.5rem;justify-content:center;flex-wrap:wrap;">
          <button class="btn-save-code" onclick="showSaveCodeUI()">Get Save Code</button>
          <button class="btn-save-code" onclick="showLoadCodeUI()">Enter Save Code</button>
        </div>
        <div id="save-code-area" style="margin-top:0.75rem;"></div>
      </div>
    </details>
    <details class="teacher-resources">
      <summary class="teacher-toggle">Teacher &amp; Student Resources</summary>
      <div class="teacher-links">
        <a href="https://lewisandclarkjournals.unl.edu/" target="_blank" rel="noopener">The Journals of Lewis &amp; Clark <span>Full digitized journals &mdash; University of Nebraska</span></a>
        <a href="http://lcatlas.lclark.edu/" target="_blank" rel="noopener">Corps of Discovery Online Atlas <span>Interactive GIS trail map &mdash; Lewis &amp; Clark College</span></a>
        <a href="https://www.nps.gov/lecl/planyourvisit/maps.htm" target="_blank" rel="noopener">NPS Lewis &amp; Clark Trail Maps <span>Official trail maps &mdash; National Park Service</span></a>
        <a href="https://www.gilderlehrman.org/history-resources/online-exhibitions/lewis-and-clark-expedition-interactive-map" target="_blank" rel="noopener">Interactive Expedition Map <span>Timeline &amp; route explorer &mdash; Gilder Lehrman Institute</span></a>
      </div>
    </details>
    <div style="margin-top:2rem;font-size:0.7rem;color:rgba(244,232,193,0.3);font-family:var(--font-ui);">v0.17.2</div>
  </div>
</div>

<!-- ============================================================
     GAME SCREEN
     ============================================================ -->
<div id="game-screen" class="screen">
  <!-- Top navigation bar -->
  <div class="top-bar">
    <div class="top-bar-left">
      <a class="home-link" onclick="goHome()" title="Return to title screen">The Lost Expedition</a>
      <span class="station-indicator" id="station-indicator">Station 1 of 10</span>
      <span class="score-display" id="score-display">0 pts</span>
    </div>
    <div class="top-bar-right">
      <div class="level-toggle" id="level-toggle">
        <button data-level="beginner" onclick="setLevel('beginner')">Easier</button>
        <button data-level="standard" onclick="setLevel('standard')">Standard</button>
        <button data-level="advanced" onclick="setLevel('advanced')">Advanced</button>
      </div>
      <button class="nav-btn active-tab" onclick="showView('station')" id="btn-view-station">Station</button>
      <button class="nav-btn" onclick="showView('map')" id="btn-view-map">Map</button>
      <button class="nav-btn" onclick="showView('journal')" id="btn-view-journal">Journal</button>
    </div>
  </div>

  <!-- Station View -->
  <div class="game-body active" id="view-station">
    <div id="station-content">
      <!-- Filled by JS -->
    </div>
  </div>

  <!-- Map View -->
  <div class="game-body" id="view-map">
    <div class="map-container">
      <div class="map-svg-wrap" id="map-svg-wrap">
        <!-- SVG map inserted by JS -->
      </div>
      <div class="map-legend">
        <div class="map-legend-item">
          <div class="map-legend-dot" style="background: #6b4423; border-color: #5c2e0a;"></div>
          <span>Not yet visited</span>
        </div>
        <div class="map-legend-item">
          <div class="map-legend-dot" style="background: #f5a623; border-color: #d4760a;"></div>
          <span>Visited</span>
        </div>
        <div class="map-legend-item">
          <div class="map-legend-dot" style="background: #8b1a1a; border-color: #fff;"></div>
          <span>Current station</span>
        </div>
        <div class="map-legend-item" style="margin-left: 1rem; opacity: 0.7;">
          <span style="font-style: italic;">Click the trail between stations for journey details</span>
        </div>
      </div>
      <div class="map-info-panel" id="map-info-panel"></div>
      <div class="map-atlas-link">
        <a href="http://lcatlas.lclark.edu/" target="_blank" rel="noopener" class="atlas-btn">&#x1F5FA; Explore the Corps of Discovery Online Atlas</a>
        <span class="atlas-credit">Lewis &amp; Clark College &mdash; interactive GIS map with detailed route layers</span>
      </div>
    </div>
  </div>

  <!-- Journal Tracker View -->
  <div class="game-body" id="view-journal">
    <div class="journal-tracker">
      <h2 class="journal-tracker-title">Expedition Journal</h2>
      <p class="journal-tracker-subtitle">Record your findings as you travel from station to station. Fill in entries at each station or edit them here.</p>
      <div style="text-align:center; margin-bottom:1rem;"><button class="btn-station-nav" style="font-size:0.8rem; padding:0.4rem 1rem;" onclick="exportJournalPDF()">Export Journal as PDF</button></div>
      <div style="overflow-x:auto;">
        <table class="tracker-table">
          <thead>
            <tr>
              <th style="width:40px;">Stn</th>
              <th style="width:100px;">Date(s)</th>
              <th style="width:110px;">Author(s)</th>
              <th>Summary</th>
              <th>Analysis</th>
            </tr>
          </thead>
          <tbody id="tracker-body">
            <!-- Filled by JS -->
          </tbody>
        </table>
      </div>
      <h3 style="margin:1.5rem 0 0.5rem;color:var(--leather-dark);font-size:1rem;">Discoveries</h3>
      <div id="discoveries-panel"></div>
    </div>
  </div>
</div>

<!-- ============================================================
     TRAIL EVENT OVERLAY
     ============================================================ -->
<div class="trail-event-overlay" id="trail-event-overlay">
  <div class="trail-event-box">
    <div class="trail-event-icon" id="trail-event-icon"></div>
    <h3 class="trail-event-title" id="trail-event-title"></h3>
    <p class="trail-event-text" id="trail-event-text"></p>
    <button class="trail-event-btn" onclick="closeTrailEvent()">Continue on the Trail</button>
  </div>
</div>

<!-- ============================================================
     TRAVEL TRANSITION OVERLAY
     ============================================================ -->
<div class="travel-overlay" id="travel-overlay">
  <div class="travel-scene" id="travel-scene"></div>
</div>

<!-- ============================================================
     COMPLETION SCREEN
     ============================================================ -->
<div id="completion-screen" class="screen">
  <div class="completion-content">
    <h1 class="completion-title">Journey Complete!</h1>
    <p class="completion-text" id="completion-text"></p>
    <button class="btn-restart" onclick="showView('journal'); showScreen('game-screen');">Review Your Journal</button>
    <button class="btn-restart btn-export" onclick="exportJournalPDF()">Export Journal as PDF</button>
    <div style="margin:1.5rem 0 0.5rem;border-top:1px solid rgba(244,232,193,0.2);padding-top:1.5rem;">
      <p style="font-size:0.9rem;color:rgba(244,232,193,0.7);margin-bottom:0.75rem;font-style:italic;">You've earned access to a bonus game!</p>
      <button class="btn-restart" style="background:linear-gradient(135deg,#2d5016,#4a7c2e);border-color:#2d5016;" onclick="TrailGame.launch()">Play the Corps of Discovery Game</button>
    </div>
    <div id="final-test-area"></div>
    <button class="btn-restart btn-secondary" onclick="restartGame()">Start a New Expedition</button>
  </div>
</div>

<!-- ============================================================
     TRAIL GAME SCREEN (unlocked after completing the journey)
     ============================================================ -->
<div id="trail-game-screen" class="screen">
  <div class="trail-game-container">
    <button class="tg-back-btn" onclick="TrailGame.exitGame()">&larr; Back to Expedition</button>
    <div id="trail-game-content">
      <!-- Filled by trail-game.js -->
    </div>
  </div>
</div>

<!-- ============================================================
     JAVASCRIPT (loaded in dependency order)
     ============================================================ -->
<script src="js/data-loader.js"></script>
<script src="js/game-state.js"></script>
<script src="js/renderers.js"></script>
<script src="js/trail-events.js"></script>
<script src="js/game-engine.js"></script>
<script src="js/trail-game.js"></script>

</body>
</html>
